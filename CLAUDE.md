# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

LAB is a containerized educational environment that provides Ubuntu 22.04 containers with SystemD support, SSH access, and Ansible integration. The project consists of a Go CLI tool (`lab`) that manages Docker containers for learning and testing purposes.

## Development Commands

### Building the Application
- **Current platform**: `make build` or `cd app && go build -o ../lab .`
- **All platforms**: `make build-all` (builds Linux AMD64/ARM64, macOS AMD64/ARM64)
- **Dependencies**: `make deps` (runs `go mod download` and `go mod tidy`)
- **Tests**: `make test` (runs `go test -v ./...` in app directory)
- **Clean**: `make clean` (removes all compiled binaries)

### Docker Operations
- **Initialize lab environment**: `./lab init [--containers N]` (generates dynamic docker-compose.yml and runs `docker compose up -d`)
- **Start existing lab environment**: `./lab start` (starts containers using existing docker-compose.yml)
- **Stop lab environment**: `./lab stop` (runs `docker compose down`)
- **Clean environment**: `./lab clean` (completely removes containers, volumes, networks, images but preserves docker-compose.yml)
- **Check status**: `./lab status` (shows running containers and connection details)

### Lab Management
- **Generate Ansible inventory**: `./lab inventory` (creates `inventory.yml` from running containers)
- **Test connectivity**: `./lab test` (tests SSH and Ansible connectivity)

## Architecture

### Go Application Structure (`app/main.go`)
- Single-file CLI application with colored output using `fatih/color` and `olekukonko/tablewriter`
- Commands: `init`, `start`, `stop`, `clean`, `status`, `inventory`, `test`
- Docker integration via `docker compose` and direct `docker` commands
- SSH connectivity testing with cross-platform timeout handling
- Dynamic Ansible inventory generation based on running containers
- Separation of initialization (`init`) and startup (`start`) operations

### Container Environment
- **Base**: Ubuntu 22.04 LTS with SystemD support
- **Networking**: Custom bridge network (`lab-network`, 172.20.0.0/16)
- **Containers**: `lab-01` (SSH port 2222) and `lab-02` (SSH port 2223)
- **Persistent Storage**: Named volumes for home directories and systemd services
- **Credentials**: Default user `labuser`/`labpass123`, root `root`/`labroot123`

### Key Files
- `app/main.go`: Main CLI application with init/start separation
- `docker-compose.yml`: Multi-container orchestration (generated by `init` command)
- `Dockerfile`: Container image definition
- `entrypoint.sh`: Container startup script
- `Makefile`: Cross-platform build automation
- `inventory.yml`: Generated Ansible inventory

### Command Workflow
1. **Initialization**: `./lab init [--containers N]` - Creates docker-compose.yml and starts environment (warns if overwriting)
2. **Daily Usage**: `./lab start` - Starts existing environment, `./lab stop` - Stops environment
3. **Complete Reset**: `./lab clean` - Removes containers, volumes, networks, images (preserves docker-compose.yml)
4. **Reinitialization**: After `./lab clean`, can use `./lab init` to create fresh configuration
5. **Status Check**: `./lab status` - Shows current state and connection details

## Development Dependencies

- **Go 1.21+** required
- **Docker and Docker Compose** for container operations
- **sshpass** (for SSH connectivity testing)
- **Ansible** (optional, for automation features)

## Testing and Connectivity

The lab tool includes built-in connectivity testing that verifies:
- SSH access to each container
- Ansible connectivity (if installed)
- Cross-platform timeout command detection (`timeout` on Linux, `gtimeout` on macOS)

The containers are designed for educational use with SystemD services, SSH access, and persistent storage for learning Linux administration, container orchestration, and automation with Ansible.